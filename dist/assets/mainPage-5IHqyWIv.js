import"./modulepreload-polyfill-B5Qt9EMX.js";import"./components-ZI4bmTv0.js";import{auth as h}from"./firebaseConfig-DQD5iuyt.js";import{o as g}from"./vendor-BbdJX2y9.js";let a;function m(){const e=L.divIcon({className:"user-location-marker",html:'<div class="marker-pulse"></div><div class="marker-dot"></div>',iconSize:[20,20],iconAnchor:[10,10],popupAnchor:[0,-10]}),i=L.divIcon({className:"city-marker",html:'<div class="city-marker-icon">üìç</div>',iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-30]});L.divIcon({className:"search-marker",html:'<div class="search-marker-icon">üîç</div>',iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-30]}),a=L.map("map").setView([49.2827,-123.1207],12),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(a),L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{maxZoom:19,attribution:'¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors ¬© <a href="https://carto.com/attributions">CARTO</a>'});let o=!1;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){const l=n.coords.latitude,d=n.coords.longitude;a.setView([l,d],14),L.marker([l,d],{icon:e}).addTo(a).bindPopup("üìç You are here!").openPopup(),o=!0},function(n){console.warn("Location failed:",n.message),c()}):(console.warn("Geolocation is not supported by this browser."),c());function c(){setTimeout(()=>{o||L.marker([49.2827,-123.1207],{icon:i}).addTo(a).bindPopup("üèîÔ∏è Welcome to Vancouver!").openPopup()},1e3)}return a.whenReady(()=>{const n=document.getElementById("map");n&&n.classList.add("map-loaded")}),a}function y(e){if(!a){console.error("Map not initialized");return}if(!e||e.trim()==="")return;const i=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=1`;fetch(i).then(o=>o.json()).then(o=>{if(o&&o.length>0){const c=o[0],n=parseFloat(c.lat),l=parseFloat(c.lon),d=L.divIcon({className:"search-marker",html:'<div class="search-marker-icon">üîç</div>',iconSize:[30,30],iconAnchor:[15,30],popupAnchor:[0,-30]});L.marker([n,l],{icon:d}).addTo(a).bindPopup(`üìç ${c.display_name}`).openPopup(),a.setView([n,l],14),console.log("Search successful:",c.display_name)}else alert(`Location not found: ${e}`)}).catch(o=>{console.error("Search failed:",o),alert("Search failed, please try again later")})}function v(){const e=document.getElementById("reportBtn");e&&e.addEventListener("click",function(){window.location.href="./report.html"})}document.addEventListener("DOMContentLoaded",function(){typeof L<"u"?m():setTimeout(m,100),setTimeout(()=>{v()},500),setTimeout(()=>{const e=document.querySelector("app-search-bar");e&&e.addEventListener("search",i=>{const o=i.detail.query;y(o)})},500)});const u=document.getElementById("welcomeTitle"),t=document.getElementById("welcomeBox"),p=document.getElementById("welcomeMsg"),s=document.getElementById("closeWelcomeBox"),r=document.getElementById("loginRedirectBtn");s&&s.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),t.classList.add("d-none"),t.style.display="none"});r&&r.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),window.location.href="./login.html"});function f(){t.classList.remove("d-none"),t.style.display="flex"}g(h,e=>{if(e){const i=e.displayName||e.email||"User";u.textContent=`Welcome, ${i}!`,p.textContent="You are successfully logged in.",r&&(r.style.display="none"),s&&(s.style.display="block"),t.classList.add("logged-in"),t.classList.remove("logged-out"),t.style.background="linear-gradient(90deg, #e6ffe6 0%, #f6fff6 100%)",t.style.borderColor="#c3e6cb",p.style.color="#155724",f()}else u.textContent="",p.textContent="Please log in to access this page.",r&&(r.style.display="inline-block"),s&&(s.style.display="none"),t.classList.add("logged-out"),t.classList.remove("logged-in"),t.style.background="linear-gradient(90deg, #fff3cd 0%, #fffaf0 100%)",t.style.borderColor="#ffeaa7",p.style.color="#856404",f()});
